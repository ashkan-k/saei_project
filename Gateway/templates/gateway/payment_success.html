{% extends 'Layouts/admin-master.html' %}
{% load static public_tags acl_tags %}
{% load humanize %}

{% block title %} Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù…ÛŒØ² Ø¨ÙˆØ¯Ù† ØªØ±Ø§Ú©Ù†Ø´ {% endblock %}

{% block content %}

    <div class="row">

        {% if messages %}
            {% for item in messages %}
                <script>
                    Swal.fire({
                        title: "ØªØ¨Ø±ÛŒÚ© ! ğŸ¥³",
                        icon: 'success',
                        text: '{{ item }}',
                        type: "success",
                        cancelButtonColor: 'var(--primary)',
                        confirmButtonText: 'Ø§ÙˆÚ©ÛŒ',
                    })
                </script>
            {% endfor %}
        {% endif %}

        <div class="col-lg-12">
            <div class="card-box">
                <div class="card-block">
                    <h4 class="card-title">Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù…ÛŒØ² Ø¨ÙˆØ¯Ù† ØªØ±Ø§Ú©Ù†Ø´</h4>

                    <hr>

                    <span id="list">
                    <h4 class="card-title alert alert-success">ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.</h4>
                                                                          <table class="table table-hover">
                    <thead>
                    <tr>
                        <th>Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
                        <th>Ù‚ÛŒÙ…Øª</th>
                        <th>Ø´Ù†Ø§Ø³Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
                        <th>Ø¨Ø®Ø´</th>
                        <th>ÙˆØ¶Ø¹ÛŒØª</th>
                    </tr>
                    </thead>
                    <tbody>
                        
                            <tr>

                                <td>{{ payment_transaction.gateway_display | default:'---' }}</td>
    
    
                                <td>{{ payment_transaction.amount | persian_int | intcomma:False | default:'---' }} ØªÙˆÙ…Ø§Ù†</td>
    
                                <td>{{ payment_transaction.ref_id }}</td>
    
                                <td><a role="button"
                                           class="label label-{{ payment_transaction.get_item_type_class }}-border rounded">
                                            {{ payment_transaction.item_type_display }}
                                        </a></td>
    
                                <td>
                                        <a role="button"
                                           class="label label-{{ payment_transaction.get_status_class }}-border rounded">
                                            {{ payment_transaction.status_display }}
                                        </a>
                                </td>
    
                            </tr>

                    </tbody>
                    </table>

                    </span>
                </div>
            </div>
        </div>

    </div>

{% endblock %}

{% block Scripts %}
    <script>
        function DeleteConfirm(id) {
            Swal.fire({
                title: "Ù‡Ø´Ø¯Ø§Ø± ! ",
                icon: 'warning',
                text: "Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: '#00aced',
                cancelButtonColor: '#e6294b',
                confirmButtonText: 'Ø­Ø°Ù',
                cancelButtonText: 'Ø§Ù†ØµØ±Ø§Ù'
            }).then((result) => {
                if (result.isConfirmed) {
                    $('#delete_form_' + id).submit();
                }
            })
        }
    </script>

    <script>
        function SeperateNumbersByComma(value) {
            var nStr = value.toString();
            nStr = nStr.replace(/\,/g, "");
            x = nStr.split('.');
            x1 = x[0];
            x2 = x.length > 1 ? '.' + x[1] : '';
            var rgx = /(\d+)(\d{3})/;
            while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + ',' + '$2');
            }
            return x1 + x2;
        }

        function formatSalePriceNumber(value) {
            var nStr = value + '';
            return SeperateNumbersByComma(nStr);
        }
    </script>

    <script>
        app.controller('myCtrl', function ($scope, $http) {
            $scope.id = null;
            $scope.status = {};
            $scope.is_submited = false;

            $scope.ChangeStatusModal = function (id, status) {
                $scope.id = id;
                $scope.status = status;
                $('#changeStatusModal').modal('show');
            }

            $scope.ChangeStatus = function () {
                $scope.is_submited = true;

                var data = {
                    "status": $scope.status
                };

                $http.patch(`/api/course/user/${$scope.id}/`, data).then(res => {
                    createToast('success', 'ÙˆØ¶Ø¹ÛŒØª Ø¢ÛŒØªÙ… Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØºÛŒÛŒØ± Ú©Ø±Ø¯.');
                    $scope.is_submited = false;
                    setTimeout(() => {
                        location.reload()
                    }, 100)
                }).catch(err => {
                    $scope.loading = false;
                    parseError(err, 'Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯');
                });
            }
        });
    </script>
{% endblock %}